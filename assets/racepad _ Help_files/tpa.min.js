define("tpa/mixins/tpaCompBaseMixin",["zepto","lodash","reactDOM"],function(a,b,c){"use strict";var d={mobile:"unavailableInMobile",https:"unavailableInHttps"},e=function(d){var e=c.findDOMNode(d),f=a(e).offset();return b.assign({scrollTop:document.body.scrollTop||document.documentElement.scrollTop,scrollLeft:document.body.scrollLeft||document.documentElement.scrollLeft,documentHeight:a(document.body).height(),documentWidth:a(document.body).width(),x:f.left,y:f.top},e.getBoundingClientRect())},f=[];return{ALIVE_TIMEOUT:2e4,OVERLAY_GRACE:5e3,onScroll:function(){var a=e(this);f.push(a);var c=this;b.delay(function(){if(!b.isEmpty(f)){var a=f.pop();f=[],c.sendPostMessage({intent:"addEventListener",eventType:"SCROLL",params:a})}},250)},isUnderMobileView:function(){return this.props.siteData.isMobileView()},getEcomParams:function(){var a=this.getAppData();return"1380b703-ce81-ff05-f115-39571d94dfcd"===a.appDefinitionId&&this.props.siteData.currentUrl.query["ecom-tpa-params"]},_createOverlayChildComponent:function(a,c,d,e){return e=e||{},this.createChildComponent(b.merge(e,{id:d,style:this.props.style,overlay:c,applicationId:this.props.compData.applicationId,hideOverlayFunc:this._hideOverlay}),a,d)},_hideOverlay:function(){this.setState({showOverlay:!1})},_createOverlay:function(a){if(!a)return null;switch(a){case"preloader":return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAPreloaderOverlay",a,"preloaderOverlay");case"unresponsive":return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",a,"unavailableMessageOverlay",{text:"We're sorry, this content cannot be displayed. Please try again later."});case d.https:return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",a,"unavailableMessageOverlay",{text:"We're sorry, this content cannot be displayed."});case d.mobile:return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",a,"unavailableMessageOverlay",{text:"We're sorry, this content is currently not optimized for mobile view."});default:return null}},getRootStyle:function(a){return b.assign({minHeight:a.height,minWidth:a.width,visibility:this.state.visibility},a)},getCompRootStyle:function(a){return this.state&&!b.isUndefined(this.state.height)&&(a.height=this.state.height),this.state&&!b.isUndefined(this.state.width)&&(a.width=this.state.width),this.state&&(this.state.isAlive||"preloader"===this.state.overlay||"unresponsive"===this.state.overlay||this.state.overlay===d.mobile)&&(this.state.visibility="visible"),this.state.ignoreAnchors?a.zIndex=1001:a.zIndex="",a=this.getRootStyle(a)},shouldRenderIframe:function(){var a=this.state.overlay,c=!b.includes(d,a),e="unresponsive"===this.state.overlay,f=c&&!e;return this.shouldClientSpecMapBeReloaded()&&(f=f&&!!this.props.siteData.dynamicModelState),f},_getIframeProperties:function(){if(!this.shouldRenderIframe())return null;var a=this._shouldShowIframe(this.state),b=this.buildUrl(this.getBaseUrl());return{src:b,key:b,scrolling:"no",frameBorder:"0",allowTransparency:!0,allowFullScreen:!0,style:{display:a?"block":"none",width:"100%",height:"100%",overflow:"hidden",position:"absolute"}}},getSkinProperties:function(){var a=this._createOverlay(this.state.overlay),b=this._getIframeProperties(),c={"":{style:this.getCompRootStyle(this.props.style),"data-ignore-anchors":this.state.ignoreAnchors},overlay:this.state.showOverlay&&this.isNotWorker()?a:null,iframe:b?b:"remove"};return this.checkIfNeedToSendMemberData(),this.mutateSkinProperties&&(c=this.mutateSkinProperties(c)),c},checkIfNeedToSendMemberData:function(){var a=this.state.shouldGetSiteMemberDetails;if(a){var b=this.props.siteAPI.getSiteAspect("siteMembers"),c=b.getMemberDetails();c&&a.callback({authResponse:!0,data:c})}},getInitialState:function(){var a=this.isUnderMobileView()&&this.isMobileReady&&!this.isMobileReady(),b=a?d.mobile:null,c={visibility:"hidden",overlay:b,isAlive:!1,registeredEvents:[],showOverlay:!0,initialWidth:this.props.style.width};return this.mutateInitialState&&(c=this.mutateInitialState(c)),c},_showOverlayIfNeeded:function(){this.state&&this.state.isAlive===!1&&!this.state.overlay&&this.setState({overlay:this._getInitialOverlay(),visibility:"visible"})},_shouldShowIframe:function(a){var b=!0;return this.shouldClientSpecMapBeReloaded()&&(b=this.isClientSpecMapReloaded()),b&&(!a.overlay||"preloader"===a.overlay)},_getInitialOverlay:function(){return this.isMobileReady&&this.isUnderMobileView()&&!this.isMobileReady()?d.mobile:"preloader"},componentWillReceiveProps:function(a){this.resize&&this.resize(a)},componentDidMount:function(){var a=this.state.overlay;this.isNotWorker()&&(setTimeout(this._showOverlayIfNeeded,this.OVERLAY_GRACE),this.props.siteData.isViewerMode()||this.setOverlayState&&this.setOverlayState()),this.state.isAlive||b.includes(d,a)||!this.isNotWorker()||(this._appAliveTimeout=setTimeout(this._onAppAliveTimeoutExpires,this.ALIVE_TIMEOUT))},isNotWorker:function(){return this.isTPAWorker?!this.isTPAWorker():!0},_onAppAliveTimeoutExpires:function(){this.showUnresponsiveOverlay()},showUnresponsiveOverlay:function(){this.state.isAlive||this.setState({overlay:"unresponsive",visibility:"visible"})},componentWillUnmount:function(){this._clearAliveTimeout()},_clearAliveTimeout:function(){this._appAliveTimeout&&clearTimeout(this._appAliveTimeout)},setAppIsAlive:function(a){this._clearAliveTimeout(),this.setState({isAlive:!0,overlay:"preloader"===this.state.overlay?null:this.state.overlay},a)},_isUrlSecure:function(a){return/^https/.test(a)}}}),define("tpa/utils/tpaUtils",["lodash"],function(a){"use strict";function e(){return a.now()+""}var c,b="TPA_PUB_SUB_",d=function(){return a.isUndefined(c)&&(c=e()),c},f=function(a,b){var c=a.getComponentById(b),d=c&&a.getSiteData().getClientSpecMapEntry(c.props.compData.applicationId);return d},g=function(a){return a.getSiteData().getClientSpecMap()},h=function(a,b){var c=f(a,b);return c?c.appDefinitionId:null},i=function(a){var c=new RegExp("^"+b);return a.replace(c,"")},j=function(a){return b.concat(a)},k=function(a){return a&&"wysiwyg.viewer.components.tpapps.TPASection"===a.props.structure.componentType},l=function(b,c){b=b||"0.0.0",c=c||"1.41.0";var d=a.map(b.split("."),function(a){return parseInt(a,10)}),e=a.map(c.split("."),function(a){return parseInt(a,10)});return 3===d.length&&3===e.length?d[0]>=e[0]&&d[1]>=e[1]&&d[2]>=e[2]:!1},m=function(b){var c=b.cookieUtils.getCookie("_wixUIDX")||"";return c=c.slice(a.lastIndexOf(c,"|")+1),c=c.replace(/^(null-user-id|null)$/g,"")},n=function(a,b){var c=g(a),d=c[b]&&c[b].instance.split(".")[1];return d&&JSON.parse(window.atob(d))};return{Constants:{TPA_PUB_SUB_PREFIX:b,TOP_PAGE_ANCHOR_PREFIX:"TOP_PAGE_"},getCacheKiller:d,getRandomCacheKiller:e,getAppData:f,getAppDefId:h,stripPubSubPrefix:i,addPubSubEventPrefix:j,isTPASection:k,sdkVersionIsAtLeast:l,getVisitorUuid:m,getInstance:n,getClientSpecMap:g}}),define("tpa/common/TPABaseUrlBuilder",["lodash","utils"],function(a,b){"use strict";var c=function(a){this.url=b.urlUtils.parseUrl(a),this.url.query=this.url.query||{},this.url.search=null};return c.prototype={addQueryParam:function(b,c){var d=this.url.query;return c&&!a.isEmpty(c)&&(d[b]?a.isArray(d[b])?d[b].push(c):d[b]=[d[b],c]:d[b]=c),this},addMultipleQueryParams:function(b){return b&&!a.isEmpty(b)&&a.assign(this.url.query,b),this},mutateIframeSrc:function(a){return a&&(this.url=a(this.url)),this},filterQueryParams:function(b){return b&&!a.isEmpty(b)&&(this.url.query=a.pick(this.url.query,b)),this},build:function(){return b.urlUtils.buildFullUrl(this.url)}},c}),define("tpa/common/TPAUrlBuilder",["lodash","utils","tpa/common/TPABaseUrlBuilder"],function(a,b,c){"use strict";var d=function(a){c.call(this,a)};return d.prototype=a.assign(new c,{addCacheKiller:function(a){return this.addQueryParam("cacheKiller",a)},addInstance:function(a){return this.addQueryParam("instance",a)},addWidth:function(a){return this.addQueryParam("width",a)},addLocale:function(a){return this.addQueryParam("locale",a)},addViewMode:function(a){return this.addQueryParam("viewMode",a)},addCompId:function(a){return this.addQueryParam("compId",a)},addDeviceType:function(a){return this.addQueryParam("deviceType",a)},addEndpointType:function(a){return this.addQueryParam("endpointType",a)},addOrigCompId:function(a){return this.addQueryParam("origCompId",a)},addExternalId:function(a){return this.addQueryParam("externalId",a)}}),d}),define("tpa/mixins/tpaUrlBuilderMixin",["lodash","utils","tpa/utils/tpaUtils","tpa/common/TPAUrlBuilder","experiment"],function(a,b,c,d,e){"use strict";var f=function(a,b){return a.mutateIframeUrlQueryParam&&(b=a.mutateIframeUrlQueryParam(b)),b};return{getInitialState:function(){this.viewMode=this.getViewMode()},getViewMode:function(){return this.props.siteData.isViewerMode()?"site":this.props.siteData.renderFlags.componentViewMode},buildUrl:function(b,g){var h=this.state.queryParams||{};h=a.merge(h,f(this,h)),this.getEcomParams&&this.getEcomParams()&&(h["ecom-tpa-params"]=this.getEcomParams()),e.isOpen("deepLinking")&&(this.viewMode=this.getViewMode());var i=new d(b).addCompId(this.props.id).addDeviceType(this.getDeviceType(this)).addInstance(this.getAppData(this).instance).addLocale(this.props.siteData.rendererModel.languageCode).addViewMode(this.viewMode).addCacheKiller(c.getCacheKiller()).addExternalId(this.props.compData.referenceId).filterQueryParams(g).addMultipleQueryParams(h);return this.mutateIframeSrc&&i.mutateIframeSrc(this.mutateIframeSrc),i.build()}}}),define("tpa/mixins/tpaCompApiMixin",["lodash","reactDOM"],function(a,b){"use strict";return{SUPPORTED_SITE_EVENTS:{SCROLL:"SCROLL",PAGE_NAVIGATION:"PAGE_NAVIGATION",PAGE_NAVIGATION_IN:"PAGE_NAVIGATION_IN",PAGE_NAVIGATION_OUT:"PAGE_NAVIGATION_OUT",PAGE_NAVIGATION_CHANGE:"PAGE_NAVIGATION_CHANGE",STATE_CHANGED:"STATE_CHANGED"},isEventSupported:function(a){return!!this.SUPPORTED_SITE_EVENTS[a]},isCompListensTo:function(b){return a.includes(this.state.registeredEvents,b)},getAppData:function(){return this.props.siteData.rendererModel.clientSpecMap[this.props.compData.applicationId]||{}},getDeviceType:function(){return this.props.siteData.isMobileView()?"mobile":"desktop"},sendPostMessage:function(a){this.props.siteAPI.getSiteAspect("tpaPostMessageAspect").sendPostMessage(this,a)},getIframe:function(){return this.refs.iframe&&b.findDOMNode(this.refs.iframe)},startListen:function(b){this.isEventSupported(b)&&(this.setState({registeredEvents:this.state.registeredEvents.concat(b)}),this.props&&b===this.SUPPORTED_SITE_EVENTS.SCROLL&&this.props.siteAPI.getSiteAspect("windowScrollEvent").registerToScroll(this),(this.props&&a.includes(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION)||this.props&&a.includes(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION_CHANGE))&&this.props.siteAPI.getSiteAspect("tpaPageNavigationAspect").registerToPageChanged(this,b))},stopListen:function(b){this.setState({registeredEvents:a.without(this.state.registeredEvents,b)}),this.props&&b===this.SUPPORTED_SITE_EVENTS.SCROLL&&this.props.siteAPI.getSiteAspect("windowScrollEvent").unregisterToScroll(this,b),this.props&&a.includes(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION)&&this.props.siteAPI.getSiteAspect("tpaPageNavigationAspect").unregisterToPageChanged(this)},setSiteMemberDataState:function(a){this.setState({shouldGetSiteMemberDetails:a})},hasOrigComponent:function(){return!a.isUndefined(this.props.compData.origCompId)},setQueryParams:function(b){a.isObject(b)&&this.setState({queryParams:b})},isClientSpecMapReloaded:function(){return"success"===this.props.siteData.dynamicModelState},shouldClientSpecMapBeReloaded:function(){return this.props.siteData.isViewerMode()},componentWillUnmount:function(){var a=this.props.id,b=this.getAppData().appDefinitionId;this.props.siteAPI.getSiteAspect("tpaPubSubAspect").deleteCompListeners(b,a)}}}),define("tpa/mixins/tpaWidgetMixin",[],function(){"use strict";return{getBaseUrl:function(){var a=this.getAppData();if(a.widgets){var b=this.props.compData.widgetId,c=a.widgets[b];if(c){var d=this.isInMobileDevMode&&this.isInMobileDevMode();if(this.isUnderMobileView()){var e=c.mobileUrl&&(d||c.mobilePublished);return e?c.mobileUrl:c.widgetUrl}return c.widgetUrl}}return""}}}),define("tpa/mixins/tpaResizeWindowMixin",["lodash"],function(a){"use strict";function b(b){return a.isString(b)&&/^[0-9]+%$/.test(b)}function c(c){return a.isNumber(c)&&c>=0||b(c)}return{resizeWindow:function(a,b,d){var e={};this.registerReLayout(),c(b)&&(e.height=b),c(a)&&(e.width=a),this.setState(e,d)}}}),define("tpa/components/tpaWidget",["lodash","core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaWidgetMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g){"use strict";var h=b.compRegistrar,i=b.compMixins,j={displayName:"TPAWidget",mixins:[i.skinBasedComp,i.timeoutsMixin,c,d,e,f,g],mutateIframeUrlQueryParam:function(b){b.width=this.state.initialWidth;var c=this.props.structure.originCompId;return c&&!a.isEmpty(c)&&(b.originCompId=c),b}};return h.register("wysiwyg.viewer.components.tpapps.TPAWidget",j),j}),define("tpa/mixins/tpaSectionMixin",["lodash","tpa/utils/tpaUtils","experiment"],function(a,b,c){"use strict";return{isTPASection:!0,getSiteAdditionalDataFromProps:function(a){return a.siteData.currentPageInfo.pageAdditionalData||""},mutateSkinProperties:function(a){return"object"==typeof a.iframe&&(a.iframe.src=this.buildUrl(this.getBaseUrl())),a},mutateInitialState:function(a){return a.sectionUrlState=this.getSiteAdditionalDataFromProps(this.props),a.sectionUrl=this.fixSectionUrl(),a},fixSectionUrl:function(){var a=this.props.siteAPI.getPageUrl(!0);return this.endsWith(a,"/")?a:a+"/"},endsWith:function(a,b){return-1!==a.indexOf(b,a.length-b.length)},componentWillReceiveProps:function(b){if(c.isOpen("deepLinking")){var d=this.getSiteAdditionalDataFromProps(b);a.isUndefined(this.state.pushState)?b.currentPage===this.props.pageId&&this.setState({sectionUrlState:d}):this.setState({pushState:void 0}),this.reportStateChanged(d)}else{var e=this.state.sectionUrlState,f=this.getSiteAdditionalDataFromProps(b);if((e!==f||a.isEmpty(f)&&!a.isEmpty(this.state.pushState))&&this.isCompListensTo(this.SUPPORTED_SITE_EVENTS.STATE_CHANGED)&&this.sendPostMessage({intent:"addEventListener",eventType:"STATE_CHANGED",params:{newState:f}}),b.currentPage===this.props.pageId){var g=this.props.siteData.currentPageInfo.pageAdditionalData;this.state.pushState?(g!==e&&g!==this.state.pushState||this.props.currentPage!==b.currentPage)&&this.setState({sectionUrlState:f,sectionUrl:this.fixSectionUrl(),pushState:void 0}):g!==e&&this.setState({sectionUrlState:f,sectionUrl:this.fixSectionUrl()})}}},reportStateChanged:function(a){this.isCompListensTo(this.SUPPORTED_SITE_EVENTS.STATE_CHANGED)&&this.sendPostMessage({intent:"addEventListener",eventType:"STATE_CHANGED",params:{newState:a}})},isMobileReady:function(){var a=this.getAppData(),b=this.isInMobileDevMode&&this.isInMobileDevMode();return a.sectionMobileUrl&&(b||a.sectionMobilePublished)},mutateIframeUrlQueryParam:function(a){return this.props.siteData.isViewerMode()?(c.isOpen("deepLinking")?a["section-url"]=this.fixSectionUrl():a["section-url"]=this.state.sectionUrl,a.target="_top"):(a["section-url"]=this.getBaseUrl(),a.target="_self"),a.width=this.state.initialWidth,a},mutateIframeSrc:function(a){return a=this.addStateToUrlObj(a,this.state.sectionUrlState)},addStateToUrlObj:function(a,b){if(b){var c="#"===b.charAt(0);c?a.hash=b:("/"!==a.path.slice(-1)&&(a.path+="/"),a.path+=b)}return a}}}),define("tpa/components/tpaSection",["lodash","core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaSectionMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g){"use strict";var h=b.compRegistrar,i=b.compMixins,j={displayName:"TPASection",mixins:[i.skinBasedComp,i.timeoutsMixin,c,d,e,f,g],getBaseUrl:function(){var b=this.getAppData(),c=this.props.compData.widgetId,d=b.sectionUrl,e=b.sectionDefaultPage,f=this.props.compData.type,g=this.isUnderMobileView()&&this.isMobileReady();if("TPAWidget"===f&&c){var h=a.find(b.widgets,{widgetId:c});h&&(e=h.appPage.defaultPage,d=g?h.mobileUrl:h.widgetUrl)}else g&&(d=b.sectionMobileUrl);return e&&!a.isEmpty(e)&&("/"!==d.slice(-1)&&(d+="/"),d+=e),d}};return h.register("wysiwyg.viewer.components.tpapps.TPASection",j),j}),define("tpa/components/tpaMultiSection",["lodash","core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaSectionMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g){"use strict";var h=b.compRegistrar,i=b.compMixins,j={displayName:"TPAMultiSection",mixins:[i.skinBasedComp,i.timeoutsMixin,c,d,e,f,g],getBaseUrl:function(){var b=this.getAppData(),c=b.sectionUrl,d=b.widgets[this.props.compData.widgetId],e=b.sectionDefaultPage;return d&&(c=this.isUnderMobileView()&&this.isMobileReady()?d.mobileUrl:d.widgetUrl,e=d.appPage.defaultPage),e&&!a.isEmpty(e)&&("/"!==c.slice(-1)&&(c+="/"),c+=e),c}};return h.register("wysiwyg.viewer.components.tpapps.TPAMultiSection",j),j}),define("tpa/components/tpaWorker",["core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin"],function(a,b,c,d){"use strict";var e=a.compRegistrar,f=a.compMixins,g={mixins:[f.skinBasedComp,b,c,d],getBaseUrl:function(){var a=this.getAppData();return a.appWorkerUrl},mutateIframeUrlQueryParam:function(a){return a.endpointType="worker",a},mutateSkinProperties:function(a){return a.iframe&&a.iframe.style&&(a.iframe.style.display="none"),a},isTPAWorker:function(){return!0}};e.register("tpa.viewer.classes.TPAWorker",g)}),define("tpa/components/tpaGluedWidget",["core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaWidgetMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f){"use strict";var g=a.compRegistrar,h=a.compMixins,i={displayName:"TPAGluedWidget",mixins:[h.skinBasedComp,h.timeoutsMixin,b,c,d,e,f],mutateIframeUrlQueryParam:function(a){return a.width=this.state.initialWidth,a}};g.register("wysiwyg.viewer.components.tpapps.TPAGluedWidget",i)}),define("tpa/aspects/TPAWorkerAspect",["lodash","core"],function(a,b){"use strict";function e(a){this._aspectSiteAPI=a}var c=function(a){return{componentType:"tpa.viewer.classes.TPAWorker",skin:"wysiwyg.viewer.skins.TPAWidgetSkin",type:"Component",id:a}},d=function(a,d,e){var f="tpaWorker_"+e.applicationId,g=c(f),h=b.componentPropsBuilder.getCompProps(g,a,null,d);return h.compData=e,b.compFactory.getCompClass(g.componentType)(h)};return e.prototype={getComponentStructures:function(){var b=[],d=this._aspectSiteAPI.getSiteData().getClientSpecMap(),e=this.getTPAWorkers(d);if(!a.isEmpty(e)){var f=c();b.push(f)}return b},getTPAWorkers:function(b){var c=a.filter(b,function(b){return a.isString(b.appWorkerUrl)&&b.permissions&&!b.permissions.revoked});return c},getReactComponents:function(b){var c=this._aspectSiteAPI.getSiteData().getClientSpecMap(),e=this._aspectSiteAPI.getSiteAPI(),f=this.getTPAWorkers(c),g=[];return a.forEach(f,function(a){var c=d(e,b,a);g.push(c)}),g}},e}),define("tpa/bi/events.json",[],function(){return{JS_SDK_FUNCTION_CALL:{eventId:12,adapter:"sdk",src:11,params:{visitor_id:"visitorUuid",sdk_ver:"sdkVersion",origin:"origin",function_name:"fnName",namespace:"namespace",app_id:"appId",instance_id:"instanceId",is_published:"isPublished"}},GALLERY_FUNCTION_CALL:{eventId:11,adapter:"sdk",src:11,params:{visitor_id:"visitorUuid",sdk_ver:"sdkVersion",origin:"origin",function_name:"fnName",namespace:"namespace"}}}}),define("tpa/bi/events",["tpa/bi/events.json","lodash","utils"],function(a,b,c){"use strict";var d=c.logger;return d.register("tpa","event",a),a}),define("tpa/bi/tpaBi",["lodash","tpa/utils/tpaUtils","tpa/bi/events","utils"],function(a,b,c,d){"use strict";var e=function(a){return a?c.JS_SDK_FUNCTION_CALL:c.GALLERY_FUNCTION_CALL},f=function(a,b){var c=a.widgets,d=c[b.props.compData.widgetId],e=d?d.published:a.sectionPublished;return e?1:0},g=function(a,c){var d=b.getClientSpecMap(a),e=b.getInstance(a,c.appId);if(!d[c.appId])throw"app definition could not be found by the given appId";var g=a.getComponentById(c.compId);return{appId:d[c.appId].appDefinitionId,instanceId:e.instanceId,isPublished:f(d[c.appId],g)}},h=function(b,c){return c.component=b.getComponentById(c.compId),c.appId=a.get(c,"component.props.compData.applicationId"),c},i=function(a){return a.component&&a.component.props.compData&&a.version&&a.type&&a.namespace},j=function(c,f){var j=h(f,c);if(i(j)){var k={visitorUuid:b.getVisitorUuid(d),sdkVersion:j.version,origin:"viewer",fnName:j.type,namespace:j.namespace};if(j.appId){var l=g(f,j);a.merge(k,l)}var m=e(j.appId);f.reportBI(m,k)}};return{sendBIEvent:j}}),define("tpa/common/tpaPostMessageCommon",["lodash","tpa/bi/tpaBi"],function(a,b){"use strict";var c={TPA_MESSAGE:"TPA",TPA_MESSAGE_PREVIEW:"TPA_PREVIEW",TPA_MESSAGE2:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",TPA_PREVIEW_RESPONSE:"TPA_PREVIEW_RESPONSE",PINGPONG_PREFIX:"pingpong:"},d=function(a,b){var c={getSectionUrl:!0,siteInfo:!0,navigateToPage:!0,getExternalId:!0,smRequestLogin:!0,getValue:!0,getValues:!0,getCurrentPageAnchors:!0};return!("preview"===a.getSiteData().viewMode&&c[b.type])},e=function(b){return"preview"===b.getSiteData().viewMode&&a.get(window,"documentServices.tpa.__privates.areDocumentServicesHandlersReady")&&window.documentServices.tpa.__privates.areDocumentServicesHandlersReady()},f=function(a,b,c){var d="";try{d=JSON.stringify(b)}catch(e){return}a.postMessage||(a=a.contentWindow),a.postMessage(d,c||"*")},g=function(a,b,d){return function(e){try{f(a,{intent:d||c.TPA_RESPONSE,callId:b.callId,type:b.type,res:e,status:!0})}catch(g){}}},h=function(a){return a===c.TPA_MESSAGE||a===c.TPA_MESSAGE2},i=function(a){return a===c.TPA_MESSAGE_PREVIEW},j=function(a){return a.replace(c.PINGPONG_PREFIX,"")},k=function(a,f,j,k){var l;try{k.data?l=JSON.parse(k.data):k.originalEvent&&k.originalEvent.data&&(k=k.originalEvent,l=JSON.parse(k.data))}catch(m){return}l&&h(l.intent)?a?(j(a,f,l,g(k.source,l)),b.sendBIEvent(l,f)):!d(f,l)&&e(f)||(j(f,l,g(k.source,l)),b.sendBIEvent(l,f)):l&&i(l.intent)&&(a?j(a,f,l,g(k.source,l,c.TPA_PREVIEW_RESPONSE)):j(f,l,g(k.source,l,c.TPA_PREVIEW_RESPONSE)))};return{Intents:c,callPostMessage:f,generateResponseFunction:g,isTPAMessage:h,fixOldPingPongMessageType:j,handleTPAMessage:k}}),define("tpa/utils/sitePages",["lodash","utils"],function(a,b){"use strict";var c=function(a){var c=b.menuUtils.getSiteMenu(a,!1),e=g(c),f=a.getMainPageId(),h=d(e,f);return h},d=function(b,c){return a.map(b,function(a){return a.isHomepage=e(a,c),a.subPages&&(a.subPages=d(a.subPages,c)),a})},e=function(b,c){return!a.isUndefined(b)&&b.id===c},f=function(a){var b=c(a);return j(b,a)},g=function(b){var c=[];return a.forEach(b,function(b){var d=h(b),e=b.items;a.forEach(e,function(a){var b=h(a);d.subPages=d.subPages||[],d.subPages.push(b)}),c.push(d)}),c},h=function(c){if(c.link){var d=a.get(c.link,"pageId.id");return{title:c.label||"",id:b.stringUtils.startsWith(d,"#")?d.substr(1):d,hide:!c.isVisible||!1}}return{}},i=function(a,b){return b.getDataByQuery(a,"masterPage")},j=function(b,c){var d=[];return a.forEach(b,function(b){a.forEach(b.subPages,function(a){d.push(i(a.id,c))}),d.push(i(b.id,c))}),d};return{getSitePagesInfoData:c,getSitePagesData:f}}),define("tpa/services/pageService",["lodash","tpa/utils/sitePages"],function(a,b){"use strict";var c={},d=function(d){if(a.size(c)>0)return c;var e=b.getSitePagesData(d.getSiteData());return a.forEach(e,function(b){if(b&&b.tpaApplicationId>0){var d={pageId:b.id,tpaId:b.tpaApplicationId,tpaPageId:b.tpaPageId};a.isUndefined(c[d.tpaId])&&(c[d.tpaId]=[]),c[d.tpaId].push(d)}}),c};return{mapPageToWidgets:d}}),define("tpa/utils/tpaStyleUtils",["lodash","color","fonts","utils"],function(a,b,c,d){"use strict";var e="param_color_",f="param_number_",g="param_boolean_",h="param_font_",i=function(){return{Title:"font_0",Menu:"font_1","Page-title":"font_2","Heading-XL":"font_3","Heading-L":"font_4","Heading-M":"font_5","Heading-S":"font_6","Body-L":"font_7","Body-M":"font_8","Body-S":"font_9","Body-XS":"font_10"}},j=function(){var b=i();return a.invert(b)},k=function(a,b){var d=c.fontUtils.parseFontStr(a),e=c.fontUtils.getFontFamilyWithFallbacks(d.family);return{editorKey:b,lineHeight:d.lineHeight,style:d.style,weight:d.weight,size:d.size,fontFamily:d.family.toLowerCase(),value:"font:"+[d.style,d.variant,d.weight,d.size+"/"+d.lineHeight,e].join(" ")+";"}},l=function(a){var c=a.split(",");return b({r:c[0],g:c[1],b:c[2]}).hexString()},m=function(b,c,d){return n(a.assign(o(d,c),y(b)),c)},n=function(b,d){var e={};a.forEach(b,function(a){"string"==typeof a&&(a=JSON.parse(a)),e[a.family||a.fontFamily]=1});var f=c.fontUtils.getFontsUrl(e,d);return-1!==f.indexOf("family=null")?"":f},o=function(b,c){var d={},e=p(b,c);return a.forEach(e,function(a,b){b.match(h)&&(d[b.replace(h,"")]=a)},this),d},p=function(a,b){var c=b.getAllTheme(),d=c[a.props.structure.styleId];if(!d)return null;var e=d.style&&d.style.properties;return e?e:null},q=function(c,e,f,g){var i,h=e[c];if(h&&!a.isString(h)&&h.value)return{themeName:void 0,value:h.value.cssColor||h.value.color.value||h.value.rgba};if(!f&&h&&a.isString(h)&&d.stringUtils.startsWith(h,"color_")){var j=g.getColor(h);j=j.indexOf(",")>-1?l(j):j;var k=b(j);return i=e.hasOwnProperty("alpha-"+c)&&1!==e["alpha-"+c]?"rgba("+k.values.rgb.join(",")+","+e["alpha-"+c]+")":k.hexString(),{themeName:h,value:i}}return f?{themeName:void 0,value:void 0}:{themeName:void 0,value:h}},r=function(b,c,i,j){var k=j.getAllTheme().THEME_DATA,l=d.stringUtils.startsWith(b,"alpha-");if(c.hasOwnProperty(b)&&!l)if(b.match(e))i.colors[b.replace(e,"")]=q(b,c,l,j);else if(b.match(f))i.numbers[b.replace(f,"")]=+c[b];else if(b.match(g)){var m;m=a.isBoolean(c[b])?c[b]:"false"!==c[b],i.booleans[b.replace(g,"")]=m}else if(b.match(h)){var n="object"==typeof c[b]?c[b].value:JSON.parse(c[b]);n.fontStyleParam&&"Custom"===n.preset?s(n):n.fontStyleParam&&n.theme?u(n):n.fontStyleParam?t(n,k.font):n.fontParam&&v(n),i.fonts[b.replace(h,"")]=n}},s=function(a){var b=c.fontUtils.getFontFamilyWithFallbacks(a.family),d=a.size+"px",e=a.size+(a.size/4<<0)+"px",f=a.style.italic?"italic":"normal",g=a.style.bold?"bold":"normal",h="normal",i="";i+="font:"+[f,h,g,d+"/"+e,b].join(" ")+";",i+=a.style.underline?"text-decoration:underline;":"",a.value=i},t=function(a,b){var c=y(b),d=c[a.preset];a.value=d.value,a.size=parseInt(d.size,10),a.family=d.fontFamily,a.style.bold="bold"===d.weight,a.style.italic="italic"===d.style,a.style.underline=!1},u=function(a){var b=c.fontUtils.getFontFamilyWithFallbacks(a.family),d=c.fontUtils.parseFontStr(a.preset);a.value="font:"+[d.style,d.variant,d.weight,d.size+"/"+d.lineHeight,b].join(" ")+";",a.size=parseInt(d.size,10),a.family=d.family.toLowerCase(),a.style.bold="bold"===d.weight,a.style.italic="italic"===d.style,a.style.underline=!1},v=function(a){a.family=a.value,a.value=w(a),a.size=0,a.style={bold:!1,italic:!1,underline:!1}},w=function(a){var b="font-family:"+(a.cssFontFamily||a.value)+";";return b=b.replace(/''/g,"'")},x=function(b,c){var d=b.getAllTheme().THEME_DATA,e={colors:{},numbers:{},booleans:{},fonts:{},googleFontsCssUrl:m(d.font,b,c)},f=p(c,b);return f?(a.forEach(f,function(a,c){r(c,f,e,b)}),e):e},y=function(b){var c=0;return a.reduce(i(),function(a,d,e){return a[e]=k(b[c++],d),a},{})},z=function(b){return a.reduce(b,function(a,b,c){return(c>=1&&5>=c||c>=11&&35>=c)&&a.push({name:"color_"+c,value:b.indexOf(",")>-1?l(b):b}),a},[])},A=function(b){return a.forEach(b,function(b){b.fonts=a.reject(b.fonts,{permissions:"legacy"})})},B=function(b,d){var e=b.getSiteData(),f=e.getAllTheme().THEME_DATA,g=d&&d.hasOrigComponent()?b.getComponentById(d.getOrigComponentId()):d,h=(a.includes(e.santaBase,"localhost")?e.santaBase:e.santaBase.replace("http://","//"))+"/static/images/editorUI/fonts.v3.png",i=A(c.fontUtils.getCurrentSelectablefonts(e));return{fonts:{cssUrls:c.fontUtils.getWixStoredFontsCssUrls(e),imageSpriteUrl:h,fontsMeta:i},siteTextPresets:y(f.font),siteColors:z(f.color),style:g?x(e,g):{}}};return{getTextPresets:y,getSiteColors:z,getStylesForSDK:x,getStyleDataToPassIntoApp:B,getNameToFontsKeyMap:j}}),define("tpa/bi/errors.json",[],function(){return{SDK_SET_HEIGHT_ERROR:{errorCode:190,desc:"sdk - set height with a big number",severity:"error",params:{p1:"height"}},SDK_PUBSUB_PUBLISH_ERROR:{errorCode:191,desc:"sdk - pubSub: publish error. App not installed on site - cannot find appDefId",severity:"error"},SDK_NAVIGATION_TO_SECTION_ERROR:{errorCode:192,desc:"sdk - navigate to section failed",severity:"error",params:{p1:"appDefinitionName",p2:"sectionId"}},ECOM_MISSING_PAGES:{errorCode:300,desc:"missing ecom pages",severity:"error"}}}),define("tpa/bi/errors",["tpa/bi/errors.json","lodash","utils"],function(a,b,c){"use strict";var d=c.logger;return b.forEach(a,function(a,b){a.errorName=b}),d.register("tpa","error",a),a}),define("tpa/handlers/anchorHandlers",["lodash","utils","tpa/utils/tpaUtils"],function(a,b,c){"use strict";function i(a,b){var c=a.getComponentById(b),d=c.props.compData;return d&&d.id}function j(a,c){var d=b.anchorUtils.getPageTopAnchor(c);return a===d.compId}var d=function(a){return{id:a.compId,title:a.name}},e=function(a,b,c){c(f(a))},f=function(e){var f=e.getCurrentPageId(),g=c.Constants.TOP_PAGE_ANCHOR_PREFIX+f,h=b.anchorUtils.getPageAnchors(e.getSiteData(),f,g);return a.map(h,d)},g=function(a,c,d){var e=c.data.anchorId,f=a.getCurrentPageId();if(j(e,f)){var g=b.anchorUtils.getPageTopAnchor(f);a.scrollToAnchor(g.id)}else if(h(a,e)){var k=i(a,e);k&&a.scrollToAnchor(k)}else d({error:{message:'anchor with id "'+e+'" was not found on the current page.'}})},h=function(b,c){var d=f(b);return a.some(d,{id:c})};return{getCurrentPageAnchors:e,navigateToAnchor:g}}),define("tpa/handlers/tpaHandlers",["zepto","lodash","react","core","utils","animations","tpa/utils/sitePages","tpa/services/pageService","tpa/utils/tpaUtils","tpa/utils/tpaStyleUtils","tpa/bi/errors","reactDOM","tpa/handlers/anchorHandlers","experiment"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";var o=e.logger,p=1e6,q=d.activityTypes.TPAActivity,r=d.ActivityService,s={APP:"APP",COMPONENT:"COMPONENT"},t=function(a,b,c){var d={},e=a.getCurrentPageData();i.sdkVersionIsAtLeast(b.version,"1.42.0")?d.pageTitle=e.siteTitle:(d.siteTitle=e.siteTitle,d.pageTitle=e.title),d.siteDescription=e.descriptionSEO,d.siteKeywords=e.metaKeywordsSEO;var f=a.getSiteData().currentUrl;d.url=f.full,d.baseUrl=a.getSiteData().getExternalBaseUrl(),d.referer=document.referrer,c(d)},u=function(a,b){var c="number"==typeof b.data?b.data:b.data.height;if(c>p){var d={height:c};o.reportBI(a.getSiteData(),k.SDK_SET_HEIGHT_ERROR,d)}var e={height:c,ignoreAnchors:b.data.overflow},f=a.getComponentById(b.compId);f.registerReLayout(),f.setState(e)},v=function(a,b,c){c(a.getCurrentPageId())},w=function(a,b){a.navigateToPage({pageId:b.data.pageId})},x=function(a,b,c){c(g.getSitePagesInfoData(a.getSiteData()))},y=function(a,c,d){var e=a.getComponentsByPageId(c),f=b.find(e,"isTPASection");f&&f.setState({sectionUrlState:d})},z=function(a,c,d){var e=a.getComponentById(c.compId);if(e){var j,k,f=h.mapPageToWidgets(a),g=e.getAppData(),i=f[g.applicationId],l=c.data;if(b.isObject(c.data)&&(l=c.data.state,k=c.data.sectionIdentifier&&c.data.sectionIdentifier.sectionId),b.isUndefined(i))A(a,g.appDefinitionName,k),d({error:{message:'Page with app "'+g.appDefinitionName+'" was not found.'}});else{if(b.isUndefined(k))j=i[0].pageId;else{var m=b.find(i,{tpaPageId:k});if(b.isUndefined(m))return A(a,g.appDefinitionName,k),void d({error:{message:'App page with sectionId "'+k+'" was not found.'}});j=m.pageId}y(a,j,l),a.navigateToPage({pageId:j,pageAdditionalData:l})}}else A(a),d({error:{message:"Component was not found."
}})},A=function(a,b,c){var d={appDefinitionName:b||"",sectionId:c||""};o.reportBI(a.getSiteData(),k.SDK_NAVIGATION_TO_SECTION_ERROR,d)},B=function(a,b){a.scrollSiteBy(b.data.x,b.data.y)},C=function(a,b){a.scrollSiteTo(b.data.x,b.data.y)},D=function(a,c,d){var e=c.data.pageId,f=c.data.compId,g=n.isOpen("popups")?a.getActivePageId():a.getCurrentPageId(),h=a.getComponentById(f);if(h&&"wysiwyg.viewer.components.tpapps.TPAGluedWidget"===h.props.structure.componentType)return void d({error:{message:"Navigation to glued widget not supported."}});if(b.isEmpty(e)||e===g)E(a,h,f,e,d);else if(b.includes(a.getSiteData().getAllPageIds(),e)){var i=a.getSiteAspect("actionsAspect");i.registerPageTransitionComplete(E.bind(null,a,h,f,e,d)),a.navigateToPage({pageId:e})}else d({error:{message:'Page id "'+e+'" was not found.'}})},E=function(a,c,d,e,g){if(e=e||(n.isOpen("popups")?a.getActivePageId():a.getCurrentPageId()),c=c||G(a,d,e),!c||!F(c)&&c.props.pageId!==e){var h=b.isEmpty(e)?"Current page":'Page id "'+e+'"';return void g({error:{message:h+' does not contain the component id "'+d+'".'}})}var i=H(c,a);f.animate("BaseScroll",a.getSiteContainer(),1,0,{y:i.y,x:i.x,callbacks:{onComplete:g}})},F=function(a){return"masterPage"===a.props.pageId},G=function(a,b,c){var d=a.getComponentsByPageId(c);return d[b]},H=function(a,c){var d=c.getSiteData(),f=l.findDOMNode(a),g=d.measureMap.siteMarginTop||0,h=e.domMeasurements.getElementRect(f),i=h.top+g;b.get(d,"measureMap.custom.SITE_HEADER.isFixedPosition")&&(i-=d.measureMap.height.SITE_HEADER);var j=e.anchorUtils.normalizeYOffset(i,d),k=h.left;return{x:k,y:j}},I=function(c,d,e){var f=c.getSiteData(),g=c.getComponentById(d.compId),h=l.findDOMNode(g),i=b.get(f,"measureMap.custom.SITE_HEADER.isFixedPosition"),j=0;i&&(j=f.measureMap.height.SITE_HEADER),e({rect:J(h,j),offsets:K(a(h).offset(),j)})},J=function(a,c){var d=a.getBoundingClientRect(),e=b(d).pick(["left","right","top","bottom","height","width"]).mapValues(function(a){return Math.floor(a)}).value();return c&&(e.top-=c),e},K=function(a,b){return{x:a.left,y:a.top-b}},L=function(a,b,c){var d=a.getComponentById(b.compId),e=a.getSiteAspect("tpaModalAspect");e.showModal(S(b,d),c)},M=function(a,b,c){var d=a.getComponentById(b.compId);if(!N(d)){var e=new Error;throw e.name="Operation not supported",e.message="An app can not open a popup from a modal.",e}var f=a.getSiteAspect("tpaPopupAspect");f.showPopup(S(b,d),c)},N=function(a){var c=["wysiwyg.viewer.components.tpapps.TPAModal"];return!b.includes(c,a.props.structure.componentType)},O=function(a,b){var c=a.getComponentById(b.compId);c&&c.hide&&c.hide(b.data)},P=function(a){return b.isString(a)&&/^[0-9]+%$/.test(a)},Q=function(a){var c=["wysiwyg.viewer.components.tpapps.TPAGluedWidget","wysiwyg.viewer.components.tpapps.TPAPopup","wysiwyg.viewer.components.tpapps.TPAModal"];return a&&a.resizeWindow&&b.includes(c,a.props.structure.componentType)},R=function(a,b,c){var d=b.data.width,e=b.data.height;P(d)||(d=parseFloat(d)),P(e)||(e=parseFloat(e));var f=a.getComponentById(b.compId);Q(f)&&f.resizeWindow(d,e,c)},S=function(c,d){var e=b.merge(c.data,{origCompId:c.compId}),f=l.findDOMNode(d);e.origCompStyle=a(f).offset();var g=f.getBoundingClientRect();return e.origCompStyle.actualTop=g.top,e.origCompStyle.actualLeft=g.left,e.position=b.defaults(e.position||{},{origin:"FIXED",placement:"CENTER",x:0,y:0}),e.position.x=U(e.position.x),e.position.y=U(e.position.y),e.windowSize={width:a(window).width(),height:a(window).height()},e.applicationId=d.props.compData.applicationId,e.tpaData=T(d),e},T=function(a){return a.props.compData.tpaData},U=function(a){if(b.isString(a)){var c=parseInt(a,10);return b.isNaN(c)?0:c}return b.isNumber(a)?a:0},V=function(a,b){var c=b.data.eventKey,d=a.getComponentById(b.compId);d&&!d.isCompListensTo(c)&&d.startListen(c)},W=function(a,b){var c=b.data.eventKey||b.data,d=a.getComponentById(b.compId);d&&d.stopListen(c)},X=function(a,b){var f,c="string"==typeof b.data?b.data:b.data.state,d=n.isOpen("popups")?a.getActivePageId():a.getCurrentPageId(),e=a.getComponentById(b.compId);try{switch(f=JSON.parse(c),f.cmd){case"zoom":e.processImageClick(f);break;case"componentReady":e.setComponentInIframeReady();break;case"navigateToAnchor":var g=f.args[0],h=f.args[1];d===g?h&&a.scrollToAnchor(h):a.navigateToPage({pageId:g,pageAdditionalData:null,anchorData:h});break;default:Y(a,e,d,c)}}catch(i){Y(a,e,d,c)}},Y=function(a,b,c,d){i.isTPASection(b)&&(b.setState({pushState:d}),a.navigateToPage({pageId:c,pageAdditionalData:d}))},Z=function(a,c,d){var e=a.getComponentById(c.compId);if(e){var f=h.mapPageToWidgets(a),g=a.getSiteData().getClientSpecMap()[e.props.compData.applicationId],i=g.applicationId;if(b.isEmpty(f)||b.isUndefined(f[i]))d({error:{message:'Page with app "'+g.appDefinitionName+'" was not found.'}});else{var m,j=f[i],k=c.data.sectionIdentifier,l=b.find(j,{tpaPageId:k})||j[0];if(l&&(m=l.pageId),b.isUndefined(m))d({error:{message:"Page was not found."}});else{var n=a.getPageUrlFor(m);d(b.isUndefined(n)?{error:{message:"Page was not found."}}:{url:n})}}}else d({error:{message:"Component was not found."}})},$=function(a,b,c,d){var e=c.getMemberDetails();null===e?a.setSiteMemberDataState({callback:d}):(d(e),a.setSiteMemberDataState(null))},_=function(a,b,c){var d=a.getComponentById(b.compId),e=a.getSiteAspect("siteMembers"),f=e.isLoggedIn();f?$(d,b,e,function(a){c({authResponse:!0,data:a})}):e.showSignUpDialog(function(a){c({authResponse:!0,data:a})})},aa=function(a,b,c){var d=a.getComponentById(b.compId),e=a.getSiteAspect("siteMembers"),f=e.isLoggedIn();f?$(d,b,e,function(a){c(a)}):c(null)},ba=function(a,b){var c=b.data,d=a.getComponentById(b.compId),f=a.getSiteData(),g=i.getAppData(a,b.compId),h=g.instance,j={type:c.activity.type||"TPA",appDefinitionId:g.appDefinitionId||"TPA",info:c.activity.info||{},details:c.activity.details||{},contactUpdate:c.activity.contactUpdate||{},instance:h},k=function(a){a.userSessionToken&&(f.pubSvSession(a.userSessionToken),e.cookieUtils.deleteCookie("svSession",f.currentUrl.hostname,f.getMainPagePath()),e.cookieUtils.setCookie("svSession",a.userSessionToken,null,f.currentUrl.hostname,f.getMainPagePath())),m({status:!0,response:a})},l=function(a){var b={status:a.status,statusText:a.statusText,responseText:a.responseText};m({status:!1,response:b})},m=function(a){d.sendPostMessage({intent:"TPA_RESPONSE",compId:b.compId,callId:b.callId,type:b.type,status:a.status,res:{response:{activityId:a.response.activityId,contactId:a.response.contactId},status:a.status}})},n=new q(f,j),o=new r(f.currentUrl.host);o.reportActivity(n,k,l)},ca=function(a,b,c){c(a.getUserSession())},da=function(a,b,c){var d=a.getComponentById(b.compId);d&&d.setAppIsAlive&&d.setAppIsAlive(),c(j.getStyleDataToPassIntoApp(a,d))},ea=function(a,b){return j.getStyleDataToPassIntoApp(a,b)},fa=function(a,b,c){b.data.messageId=Date.now();var d={ctToken:a.getSiteData().ctToken},f=b.data,g="?"+e.urlUtils.toQueryString(d),h="http://player-counters.wix.com/collector/rest/collect-js"+g,i=function(a){c({status:"success",response:a})},j=function(a){var b=a&&a.responseText;c({status:"error",response:b})};e.ajaxLibrary.ajax({type:"POST",url:h,data:JSON.stringify(f),dataType:"json",contentType:"application/json",success:i,error:j})},ga=function(a,b,c){var d=a.getComponentById(b.compId);d&&c(d.props.compData.referenceId)},ha=function(){},ia=function(a,b,c){var d=a.getSiteData(),e=d.isViewerMode()?"site":d.renderFlags.componentViewMode;c({editMode:e})},ja=function(a,c,d){var j,e=c.data.key,f=c.data.scope,g=a.getSiteData(),h=a.getComponentById(c.compId),i=h.props.compData;j=f===s.APP?la(g,e,"tpaData-"+i.applicationId,"masterPage"):la(g,e,i.tpaData,a.getCurrentPageId()),d(b.isEmpty(j)?{error:{message:"key "+e+" not found in "+f+" scope"}}:j)},ka=function(a,c,d){var j,e=b.uniq(c.data.keys),f=a.getSiteData(),g=a.getComponentById(c.compId),h=g.props.compData,i=c.data.scope;if(i===s.APP){var k=ma(f,"tpaData-"+h.applicationId,"masterPage");j=b.pick(k,e)}else{var l=ma(f,h.tpaData,a.getCurrentPageId());j=b.pick(l,e)}if(!b.isEmpty(j)&&b(j).keys().isEqual(e))d(j);else{var m=b.keys(j),n=b(m).xor(e).intersection(e).value();d({error:{message:"keys "+n+" not found in "+i+" scope"}})}},la=function(a,c,d,e){if(!b.isEmpty(d)){var f=ma(a,d,e);if(f)return b.pick(f,c)}return null},ma=function(a,b,c){var d=a.getDataByQuery(b,c);return d&&d.content?JSON.parse(d.content):null},na=function(a,b){var c=e.wixUrlParser.parseUrl(a,b);return{pageId:c.pageId,state:c.pageAdditionalData}},oa=function(a,b,c){var d={pageId:b,pageAdditionalData:c};return e.wixUrlParser.getUrl(a,d)};return{siteInfo:t,heightChanged:u,registerEventListener:V,navigateToPage:w,smRequestLogin:_,smCurrentMember:aa,scrollBy:B,scrollTo:C,navigateToComponent:D,postActivity:ba,getCurrentPageId:v,getUserSession:ca,boundingRectAndOffsets:I,navigateToSectionPage:z,getSitePages:x,removeEventListener:W,appIsAlive:da,openModal:L,openPopup:M,closeWindow:O,resizeWindow:R,appStateChanged:X,getSectionUrl:Z,getStyleDataToPassIntoApp:ea,postCountersReport:fa,getExternalId:ga,tpaWorker:{siteInfo:t,getSitePages:x,removeEventListener:W,registerEventListener:V,smCurrentMember:aa,appIsAlive:da,navigateToSectionPage:z,getViewMode:ha,getDeviceType:ha,getLocale:ha,getInstanceId:ha,getIpAndPort:ha,getValue:ja,getValues:ka},toWixDate:ha,getCompId:ha,getOrigCompId:ha,getWidth:ha,getLocale:ha,getCacheKiller:ha,getTarget:ha,getInstanceId:ha,getSignDate:ha,getUid:ha,getPermissions:ha,getIpAndPort:ha,getDemoMode:ha,getDeviceType:ha,getImageUrl:ha,getResizedImageUrl:ha,getAudioUrl:ha,getDocumentUrl:ha,getSwfUrl:ha,getViewMode:ia,getValue:ja,getValues:ka,getCurrentPageAnchors:m.getCurrentPageAnchors,navigateToAnchor:m.navigateToAnchor,getStateFromUrl:na,getUrlFromState:oa}}),define("tpa/handlers/tpaPubSubHandlers",["tpa/utils/tpaUtils","utils","tpa/bi/errors"],function(a,b,c){"use strict";var d=b.logger;return{registerEventListener:function(a,b){a.getSiteAspect("tpaPubSubAspect").subscribe(b)},publish:function(b,e){var f=e.data,g=e.compId,h=a.getAppDefId(b,g);h?(f.eventKey=a.stripPubSubPrefix(f.eventKey),b.getSiteAspect("tpaPubSubAspect").publish(h,g,f)):d.reportBI(b.getSiteData(),c.SDK_PUBSUB_PUBLISH_ERROR)},removeEventListener:function(b,c){var d=c.compId,e=c.data,f=a.getAppDefId(b,d),g=a.stripPubSubPrefix(e.eventKey);b.getSiteAspect("tpaPubSubAspect").unsubscribe(f,d,g)}}}),define("tpa/aspects/TPAPostMessageAspect",["lodash","tpa/common/tpaPostMessageCommon","tpa/handlers/tpaHandlers","tpa/handlers/tpaPubSubHandlers","tpa/utils/tpaUtils","utils","experiment"],function(a,b,c,d,e,f,g){"use strict";var h=function(b){return a.has(b,"data")&&!a.isNull(b.data)?b.data.eventKey&&f.stringUtils.startsWith(b.data.eventKey,e.Constants.TPA_PUB_SUB_PREFIX):void 0},i=function(a){return h(a)?d:k(a.compId)?c.tpaWorker:c},j=function(a,c,d){if(m(a,c.compId,c.type)){var e=b.fixOldPingPongMessageType(c.type),f=i(c);f[e]&&f[e].apply(this,[a,c,d])}},k=function(a){return a&&f.stringUtils.startsWith(a,"tpaWorker_")},l=function(a,b){return b===a.getCurrentPageId()||b===a.getCurrentPopupId()},m=function(a,b,c){var d=b&&a.getComponentById(b);if(d&&"masterPage"===d.props.pageId||"appStateChanged"!==c)return!0;if(g.isOpen("popups"))return d&&l(a,d.props.pageId);var e=a.getCurrentPageId();return d&&d.props.pageId===e},n=function(a){a.registerToMessage(this.handleTPAMessage.bind(this)),this._siteAPI=a};return n.prototype={handleTPAMessage:function(a){b.handleTPAMessage.call(this,void 0,this._siteAPI,j,a)},sendPostMessage:function(a,c){var d=a.getIframe();if(!d)throw new Error("No iframe found in TPA component",a);b.callPostMessage(d,c)},callHandler:j},n}),define("tpa/mixins/tpaRuntimeCompMixin",[],function(){"use strict";return{getOrigComponentId:function(){return this.props.compData.origCompId}}}),define("tpa/components/tpaPopup",["lodash","core","utils","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaRuntimeCompMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g){"use strict";var h=b.compRegistrar,i=b.compMixins,j={FIXED:"FIXED",ABSOLUTE:"ABSOLUTE",RELATIVE:"RELATIVE",DEFAULT:"DEFAULT"},k={bottomCenter:"BOTTOM_CENTER",bottomLeft:"BOTTOM_LEFT",bottomRight:"BOTTOM_RIGHT",center:"CENTER",centerLeft:"CENTER_LEFT",centerRight:"CENTER_RIGHT",topCenter:"TOP_CENTER",topLeft:"TOP_LEFT",topRight:"TOP_RIGHT"},l=function(a,b,c){return a+b/2-c/2},m=function(a,b,c){return a-(b+c)},n=function(a,b,c){return a-(b+c)},o=function(a,b,c){return a+b/2-c/2},p=function(b){function c(a){return/(%)$/.exec(a)}function d(a){return/^([0-9]+)/.exec(a)}var e=0,f="";if(a.isNumber(b))e=b;else if(a.isString(b)){var g=c(b),h=d(b);e=h&&h[1]?parseInt(h[1],10):0,g&&g[1]&&(f=g[1])}return{size:e,unit:f}},q=function(b,c,d,e){var f={position:"fixed",display:"block",width:d,height:e};return e=p(e),e.size="%"===e.unit?a.min([e.size,100]):a.min([e.size,c.height]),d=p(d),d.size="%"===d.unit?a.min([d.size,100]):a.min([d.size,c.width]),b.placement===k.center?a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,marginTop:"%"===e.unit?0:e.size/-2+e.unit,left:"50%",top:"%"===e.unit?0:"50%"}):b.placement===k.topLeft?a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,left:"0px",top:"0px"}):b.placement===k.topRight?a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,right:"0px",top:"0px"}):b.placement===k.topCenter?a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,top:"0px",left:"50%"}):b.placement===k.centerRight?a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginTop:"%"===e.unit?0:e.size/-2+e.unit,top:"%"===e.unit?0:"50%",right:"0px"}):b.placement===k.centerLeft?a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginTop:"%"===e.unit?0:e.size/-2+e.unit,top:"%"===e.unit?0:"50%",left:"0px"}):b.placement===k.bottomLeft?a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,bottom:"0px",left:"0px"}):b.placement===k.bottomRight?a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,bottom:"0px",right:"0px"}):b.placement===k.bottomCenter?a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,left:"50%",bottom:"0px"}):f},r=function(b,c,d,e,f){var h,i,g={position:"absolute",display:"block"};return b.placement===k.center?(e=a.min([e,d.height]),f=a.min([f,d.width]),h=o(c.top,c.height,e),i=l(c.left,c.width,f)):b.placement===k.topLeft?(e=a.min([e,c.top]),f=a.min([f,c.left]),h=c.top-e,i=c.left-f):b.placement===k.topRight?(e=a.min([e,c.top]),f=a.min([f,n(d.width,c.width,c.left)]),h=c.top-e,i=c.width+c.left):b.placement===k.topCenter?(e=a.min([e,c.top]),f=a.min([f,d.width]),h=c.top-e,i=l(c.left,c.width,f)):b.placement===k.centerRight?(e=a.min([e,d.height]),f=a.min([f,n(d.width,c.width,c.left)]),h=o(c.top,c.height,e),i=c.width+c.left):b.placement===k.centerLeft?(e=a.min([e,d.height]),f=a.min([f,c.left]),h=o(c.top,c.height,e),i=c.left-f):b.placement===k.bottomLeft?(e=a.min([e,m(d.height,c.top,c.height)]),f=a.min([f,c.left]),h=c.top+c.height,i=c.left-f):b.placement===k.bottomRight?(e=a.min([e,m(d.height,c.top,c.height)]),f=a.min([f,n(d.width,c.width,c.left)]),h=c.top+c.height,i=c.width+c.left):b.placement===k.bottomCenter&&(e=a.min([e,m(d.height,c.top,c.height)]),f=a.min([f,d.width]),h=c.top+c.height,i=l(c.left,c.width,f)),h=a.max([0,h]),i=a.max([0,i]),a.assign(g,{top:h,left:i,width:f,height:e})},s=function(b,c,d,e,f){var h,i,j,l,g={position:"absolute",display:"block"};return b.placement===k.center?(j=a.min([c.actualTop+b.y,d.height-(c.actualTop+b.y)]),e=a.min([e,2*j]),l=a.min([c.actualLeft+b.x,d.width-(c.actualLeft+b.x)]),f=a.min([f,2*l]),h=c.top+b.y-e/2,i=c.left+b.x-f/2):b.placement===k.topLeft?(e=a.min([e,c.actualTop+b.y]),f=a.min([f,c.actualLeft+b.x]),h=c.top+b.y-e,i=c.left+b.x-f):b.placement===k.topRight?(e=a.min([e,c.actualTop+b.y]),f=a.min([f,d.width-(c.actualLeft+b.x)]),h=c.top+b.y-e,i=c.left+b.x):b.placement===k.topCenter?(e=a.min([e,c.actualTop+b.y]),l=a.min([c.actualLeft+b.x,d.width-(c.actualLeft+b.x)]),f=a.min([f,2*l]),h=c.top+b.y-e,i=c.left+b.x-f/2):b.placement===k.centerRight?(j=a.min([c.actualTop+b.y,d.height-(c.actualTop+b.y)]),e=a.min([e,2*j]),f=a.min([f,d.width-(c.actualLeft+b.x)]),h=c.top+b.y-e/2,i=c.left+b.x):b.placement===k.centerLeft?(j=a.min([c.actualTop+b.y,d.height-(c.actualTop+b.y)]),e=a.min([e,2*j]),f=a.min([f,c.actualLeft+b.x]),h=c.top+b.y-e/2,i=c.left+b.x-f):b.placement===k.bottomLeft?(e=a.min([e,d.height-(c.actulaTop+b.y)]),f=a.min([f,c.actualLeft+b.x]),h=c.top+b.y,i=c.left+b.x-f):b.placement===k.bottomRight?(e=a.min([e,d.height-(c.actualTop+b.y)]),f=a.min([f,d.width-(c.actualLeft+b.x)]),h=c.top+b.y,i=c.left+b.x):b.placement===k.bottomCenter&&(e=a.min([e,d.height-(c.actualTop+b.y)]),l=a.min([c.actualLeft+b.x,d.width-(c.actualLeft+b.x)]),f=a.min([f,2*l]),h=c.top+b.y,i=c.left+b.x-f/2),h=a.max([0,h]),i=a.max([0,i]),a.assign(g,{top:h,left:i,width:f,height:e})},t=function(b,c,d,e){var f=10;if(e.width<f||e.height<f){var g=p(d);g.size="%"===g.unit?a.min([g.size,100]):a.min([g.size,b.height]);var h=p(c);return h.size="%"===h.unit?a.min([h.size,100]):a.min([h.size,b.width]),{position:"fixed",display:"block",width:h.size+g.unit,height:g.size+h.unit,marginLeft:h.size/-2+g.unit,marginTop:g.size/-2+h.unit,left:"50%",top:"50%"}}return e},u=function(a,b,c,d,e){var f={};return a.origin!==j.DEFAULT&&a.origin!==j.FIXED||(f=q(a,c,d,e)),a.origin===j.RELATIVE&&(f=r(a,b,c,e,d)),a.origin===j.ABSOLUTE&&(f=s(a,b,c,e,d)),f=t(c,d,e,f)},v=function(a){var b=a.getSiteAspect("tpaModalAspect").getReactComponents(),c=b&&b.length>0;return c?1001:null},w={displayName:"TPAPopup",mixins:[i.skinBasedComp,d,e,f,g],getInitialState:function(){return{showComponent:!0,registeredEvents:[],$displayDevice:this.getDeviceType()}},getSkinProperties:function(){var a=this.state.showComponent?this.getSelfStyle():{display:"none"},b=this.isBareTheme()?"none":"block";return this.state.showComponent?{"":{style:a},closeButton:{onClick:this.hide,style:{display:b}},iframe:{src:this.buildUrl(this.props.compData.url),scrolling:"no",frameBorder:"0",allowTransparency:!0,allowFullScreen:!0}}:{"":{style:a}}},mutateIframeUrlQueryParam:function(a){return a.origCompId=this.props.compData.origCompId,a},getSelfStyle:function(){var b=a.defaults(this.props.compData.position,{x:0,y:0}),c=this.props.compData.origCompStyle,d=this.props.compData.windowSize,e=a.isUndefined(this.state.width)?this.props.compData.width:this.state.width,f=a.isUndefined(this.state.height)?this.props.compData.height:this.state.height,g=u(b,c,d,e,f);return g.zIndex=v(this.props.siteAPI),this.getThemeStyle(g)},getThemeStyle:function(b){return this.isBareTheme()?a.merge(b,{background:"none",boxShadow:"none",borderRadius:0}):b},hide:function(c,d){var e=this;b.compFactory.invalidate("wysiwyg.viewer.components.tpapps.TPAPopup"),this.setState({showComponent:!1},function(){var b=c&&c.message?c:void 0;e.props.onCloseCallback&&e.props.onCloseCallback(b),this.props.siteAPI.getSiteAspect("tpaPopupAspect").removePopup(e),a.isFunction(d)&&d()})},isBareTheme:function(){return"BARE"===this.props.compData.theme}};return h.register("wysiwyg.viewer.components.tpapps.TPAPopup",w),w}),define("tpa/aspects/TPAPopupAspect",["lodash","core","utils","tpa/components/tpaPopup"],function(a,b,c){"use strict";function d(){return{componentType:"wysiwyg.viewer.components.tpapps.TPAPopup",type:"Component",id:c.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAPopupSkin",styleId:""}}function e(a,c,d,e,f){var g=b.componentPropsBuilder.getCompProps(a,c,null,d);return g.compData=e,g.onCloseCallback=f,b.compFactory.getCompClass(a.componentType)(g)}function f(a){this.aspectSiteApi=a,this.shouldShowPopup=!1,this.tpaPopup=[],this.aspectSiteApi.registerToPageChange(this.removeAllPopups.bind(this))}return f.prototype={getComponentStructures:function(){return this.shouldShowPopup?[d()]:null},getReactComponents:function(a){var b;if(this.shouldShowPopup){if(this.shouldShowNewPopup){this.shouldShowNewPopup=!1;var c=d();b=e(c,this.aspectSiteApi.getSiteAPI(),a,this.popupData,this.popupOnClose),this.tpaPopup.push(b)}return this.tpaPopup}return null},showPopup:function(a,b){this.shouldShowPopup=!0,this.shouldShowNewPopup=!0,this.popupData=a,this.popupOnClose=b,this.aspectSiteApi.forceUpdate()},removePopup:function(b){var c=b.props.id,d=this.tpaPopup;this.tpaPopup=a.reject(d,{props:{id:c}})},removeAllPopups:function(){a.isEmpty(this.tpaPopup)||(this.tpaPopup=[],this.shouldShowPopup=!1,this.aspectSiteApi.forceUpdate())}},f}),define("tpa/classes/PubSubHub",["lodash"],function(a){"use strict";var b=1e3,c=function(a){this.hub=a||{}};return c.prototype={persistData:function(a,c,d,e){var f={data:e,name:c,origin:d},g=this._addEvent(a,c);g.data.length>=b&&(console.warn("You have exceeded the data limit, and some of the data will be lost! Please make sure you are not persisting unneeded data."),g.data.shift()),g.data.push(f)},addEventListener:function(b,c,d){var e=this._addEvent(b,c);a.includes(e.listeners,d)||e.listeners.push(d)},removeEventListener:function(b,c,d){var e=this._getEvent(b,c);e&&(e.listeners=a.without(e.listeners,d))},getPersistedData:function(a,b){var c=this._getEvent(a,b);return c&&c.data},getEventListeners:function(a,b){var c=this._getEvent(a,b);return c&&c.listeners},deleteCompListeners:function(b,c){var d=this,e=this._getAppEvents(b);a.forOwn(e,function(a,e){d.removeEventListener(b,e,c)})},_addEvent:function(a,b){var c=this.hub[a];c||(c=this.hub[a]={});var d=c[b];return d||(d=c[b]={data:[],listeners:[]}),d},_getEvent:function(a,b){var c=this.hub[a];return c?c[b]:void 0},_getAppEvents:function(a){return this.hub[a]}},c}),define("tpa/aspects/TPAPubSubAspect",["lodash","tpa/utils/tpaUtils","tpa/classes/PubSubHub"],function(a,b,c){"use strict";var d=function(a){this.aspectSiteAPI=a,this.hub=new c};return d.prototype={publish:function(c,d,e){var f=e.eventKey,g=e.isPersistent,h=this.hub.getEventListeners(c,f),i={eventType:b.addPubSubEventPrefix(f),intent:"addEventListener",params:{data:e.eventData,name:f,origin:d}};if(a.forEach(h,function(a){this._sendDataToComp(a,i)},this),g){var j=e.eventData;this.hub.persistData(c,f,d,j)}},subscribe:function(c){var d=c.compId,e=c.data,f=b.stripPubSubPrefix(e.eventKey),g=e.receivePastEvents,h=b.getAppDefId(this.aspectSiteAPI,d);if(this.hub.addEventListener(h,f,d),g){var i=this.hub.getPersistedData(h,f);if(!a.isEmpty(i)){var j={intent:"TPA_RESPONSE",compId:d,callId:c.callId,type:c.type,status:!0,res:{drain:!0,data:i}};this._sendDataToComp(d,j)}}},unsubscribe:function(a,b,c){var d=this.hub.getEventListeners(a,c);d&&this.hub.removeEventListener(a,c,b)},deleteCompListeners:function(a,b){this.hub.deleteCompListeners(a,b)},_sendDataToComp:function(a,b){var c=this.aspectSiteAPI.getComponentById(a);c&&c.sendPostMessage(b)}},d}),define("tpa/aspects/TPAPixelTrackerAspect",["lodash","utils","tpa/common/TPABaseUrlBuilder"],function(a,b,c){"use strict";function l(a){f=a,f.registerToComponentDidMount(k),f.registerToPageChange(k)}var f,d=b.urlUtils,e=b.throttleUtils.throttledForEach,g=!1,h=function(b){return a.filter(b,function(b){return a.isString(b.pixelUrl)&&b.permissions&&!b.permissions.revoked})},i=function(){return"success"===f.getSiteData().dynamicModelState},j=function(a){new window.Image(0,0).src=a},k=function(){if(i()){var b=f.getPageUrl.bind(f),j=h(f.getSiteData().getClientSpecMap()),k=a.map(j,function(a){return new c(a.pixelUrl).addMultipleQueryParams({instance:a.instance,page:b(),ck:d.cacheKiller()}).build()});e(k,l.sendRequest,l.CHUNK_SIZE,l.CHUNK_INTERVAL)}else g=!0};return l.prototype={getReactComponents:function(){return g&&i()&&(k(),g=!1),null}},l.sendRequest=j,l.CHUNK_SIZE=1,l.CHUNK_INTERVAL=100,l}),define("tpa/aspects/TPAPageNavigationAspect",["lodash"],function(a){"use strict";var b=function(a,b,c,d){return"PAGE_NAVIGATION"===a.type||"PAGE_NAVIGATION_IN"===a.type&&d===b||"PAGE_NAVIGATION_OUT"===a.type&&d===c},c=function(a,b){this._listeners={},this._siteAPI=a,this._currentPageId=b||this._siteAPI.getCurrentPageId(),this._siteAPI.registerToPageChange(this.notifyPageChanged.bind(this))};return c.prototype={notifyPageChanged:function(){var c=this._siteAPI.getCurrentPageId(),d=this._currentPageId;a.forEach(this._listeners,function(e){a.forEach(e,function(a){var e=a.comp.props.pageId,f=a.comp.isMounted();f&&b(a,c,d,e)&&a.comp.sendPostMessage({intent:"addEventListener",eventType:a.type,params:{toPage:c,fromPage:d,isAppOnPage:e===c,wasAppOnPage:e===d}})})}),this._currentPageId=c},registerToPageChanged:function(a,b){var c=this._listeners[a.props.id];c||(c=this._listeners[a.props.id]=[]),c.push({comp:a,type:b})},unregisterToPageChanged:function(a){delete this._listeners[a.props.id]}},c}),define("tpa/mixins/tpaBlockOuterScrollMixin",[],function(){"use strict";var a=function(a){var b=a.currentTarget,c=a.currentTarget.scrollHeight,d=c-a.currentTarget.offsetHeight,e=a.deltaY%3?a.deltaY:10*a.deltaY;b.scrollTop+e<=0?(b.scrollTop=0,a.preventDefault()):b.scrollTop+e>=d&&(b.scrollTop=d,a.preventDefault()),a.stopPropagation()};return{blockOuterScroll:a}}),define("tpa/components/tpaModal",["lodash","zepto","core","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaRuntimeCompMixin","tpa/mixins/tpaResizeWindowMixin","tpa/mixins/tpaBlockOuterScrollMixin"],function(a,b,c,d,e,f,g,h){"use strict";var i=c.compRegistrar,j=c.compMixins,k={displayName:"TPAModal",mixins:[j.skinBasedComp,d,e,f,g,h],getInitialState:function(){return this.props.siteAPI.getSiteAspect("windowResizeEvent").registerToResize(this),{showComponent:!0,registeredEvents:[],$displayDevice:this.getDeviceType(),windowSize:this.props.compData.windowSize}},getDefaultProperties:function(){return{"":{style:{position:"fixed",display:"block"},onWheel:this.blockOuterScroll},blockingLayer:{onClick:this.hide},frameWrap:{style:this.getIframeWrapperStyle()},dialog:{style:this.getDialogStyle()},xButton:{children:"",onClick:this.hide,style:{display:"block"}},iframe:{src:this.buildUrl(this.props.compData.url),frameBorder:"0",allowTransparency:!0,allowFullScreen:!0}}},getHiddenProperties:function(){return{"":{style:{display:"none"}}}},getBareProperties:function(){return a.merge(this.getDefaultProperties(),{frameWrap:{style:{background:"transparent",border:"none"}},xButton:{style:{display:"none"}}})},getSkinProperties:function(){if(this.state.showComponent)switch(this.props.compData.theme){case"BARE":case"LIGHT_BOX":return this.getBareProperties();default:return this.getDefaultProperties()}return this.getHiddenProperties()},getIframeWrapperStyle:function(){var a=this.props.siteData.isMobileView(),b={};return a&&(b={WebkitOverflowScrolling:"touch",overflowY:"scroll"}),b},getDialogStyle:function(){if("mobile"===this.getDeviceType())return{};var b=this.state.windowSize,c=a.isNumber(this.state.width)?this.state.width:this.props.compData.width,d=a.isNumber(this.state.height)?this.state.height:this.props.compData.height;return c=Math.min(c,b.width),d=Math.min(d,b.height),{width:c,height:d,marginTop:-d/2,marginLeft:-c/2}},mutateIframeUrlQueryParam:function(a){return a.origCompId=this.props.compData.origCompId,a},hide:function(b,d){c.compFactory.invalidate("wysiwyg.viewer.components.tpapps.TPAModal");var e=this;this.setState({showComponent:!1},function(){var c=b&&b.message?b:void 0;e.props.onCloseCallback&&e.props.onCloseCallback(c),"mobile"===e.state.$displayDevice&&e.props.siteAPI.exitFullScreenMode(),e.props.siteAPI.getSiteAspect("windowResizeEvent").unregisterToResize(e),e.props.siteAPI.getSiteAspect("tpaModalAspect").removeModal(e),a.isFunction(d)&&d()})},isBareTheme:function(){return"BARE"===this.props.compData.theme},onResize:function(){var a=b(window);this.setState({windowSize:{width:a.width(),height:a.height()}})}};return i.register("wysiwyg.viewer.components.tpapps.TPAModal",k),k}),define("tpa/aspects/TPAModalAspect",["lodash","core","utils","tpa/components/tpaModal"],function(a,b,c,d){"use strict";function e(){return{componentType:"wysiwyg.viewer.components.tpapps.TPAModal",type:"Component",id:c.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAModalSkin"}}function f(a,c,d,e,f){var g=b.componentPropsBuilder.getCompProps(a,c,null,d);return g.compData=e,g.onCloseCallback=f,g.key=a.id,b.compFactory.getCompClass(a.componentType)(g)}function g(a){this.aspectSiteApi=a,this.modalStructure=null}return g.prototype={getComponentStructures:function(){return this.modalStructure?[this.modalStructure]:null},getReactComponents:function(a){return this.modalStructure?[f(this.modalStructure,this.aspectSiteApi.getSiteAPI(),a,this.modalData,this.modalOnClose)]:null},showModal:function(a,b){this.aspectSiteApi.getSiteData().isMobileView()&&("LIGHT_BOX"===a.theme?(this.aspectSiteApi.exitFullScreenMode(),this.aspectSiteApi.setSiteRootHiddenState(!0)):(this.aspectSiteApi.enterFullScreenMode(),this.aspectSiteApi.setSiteRootHiddenState(!1))),this.modalStructure=e(),this.modalData=a,this.modalOnClose=b,this.aspectSiteApi.forceUpdate()},removeModal:function(){this.aspectSiteApi.getSiteData().isMobileView()&&(this.aspectSiteApi.exitFullScreenMode(),this.aspectSiteApi.setSiteRootHiddenState(!1)),this.modalStructure=null,this.aspectSiteApi.forceUpdate()}},g}),define("tpa/aspects/tpaAspectCollector",["core","tpa/aspects/TPAWorkerAspect","tpa/aspects/TPAPostMessageAspect","tpa/aspects/TPAPopupAspect","tpa/aspects/TPAPubSubAspect","tpa/aspects/TPAPixelTrackerAspect","tpa/aspects/TPAPageNavigationAspect","tpa/aspects/TPAModalAspect"],function(a){"use strict";var b=a.siteAspectsRegistry;b.registerSiteAspect("tpaWorkerAspect",arguments[1]),b.registerSiteAspect("tpaPostMessageAspect",arguments[2]),b.registerSiteAspect("tpaPopupAspect",arguments[3]),b.registerSiteAspect("tpaPubSubAspect",arguments[4]),b.registerSiteAspect("tpaPixelTrackerAspect",arguments[5]),b.registerSiteAspect("tpaPageNavigationAspect",arguments[6]),b.registerSiteAspect("tpaModalAspect",arguments[7])}),define("tpa/layout/gluedWidgetPatcher",["lodash","zepto"],function(a,b){"use strict";function d(b,d,e){var f={};return a.forEach(e,function(e){var g=d[e]&&d[e][b],h=e;a.isUndefined(g)||(0===e.indexOf(c)&&(h=h.slice(c.length).toLowerCase()),f[h]=g)}),f}function e(b,c,d){return{top:a.isNumber(b.top)?a.parseInt(b.top):d-b.height,bottom:a.isNumber(b.bottom)?d-a.parseInt(b.bottom):a.parseInt(b.top)+b.height,right:a.isNumber(b.right)?c-a.parseInt(b.right):a.parseInt(b.left)+b.width,left:a.isNumber(b.left)?a.parseInt(b.left):c-b.width}}function f(a,b){return!(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom)}function g(b,c,d){return f(d,c)&&a.isNumber(b.top)&&(b.top=(b.top||0)+(d.bottom-c.top)),b}function h(a,b,c){var d=a,f=b.height.screen,h=b.width.screen,i=b.custom&&b.custom[c.WIX_ADS_ID]&&b.custom[c.WIX_ADS_ID].topAd;if(i){var j=e(d,h,f);d=g(d,j,i)}return d}function i(c,e,f,g,i){var j=["position","fixedTop","fixedLeft","right","bottom","width","height"],k=d(c,f,j);k=h(k,f,i),k=a.omit(k,"width","height"),b(e[c]).css(k)}function j(){this.patchGluedWidget=i}var c="fixed";return j}),define("tpa/layout/tpaMeasurer",["zepto"],function(a){"use strict";return{measureTPA:function(b,c,d,e,f){var g=a(d[b]),h=parseInt(g.css("min-height"),10),i=parseInt(g.css("min-width"),10),j=g.attr("data-ignore-anchors");h&&"true"!==j&&(c.minHeight[b]=h,c.height[b]=h),h&&"true"===j&&(c.minHeight[b]=f.structure.layout.height,c.height[b]=f.structure.layout.height),i&&(c.minWidth[b]=i,c.width[b]=i)}}}),define("tpa/layout/tpaGluedWidgetPlacement",[],function(){"use strict";function a(a,b){var c=a.applicationId,d=a.widgetId,e=b[c];if(e){var f=e.widgets[d];if(f){var g=f.gluedOptions||{horizontalMargin:0,placement:"BOTTOM_RIGHT",verticalMargin:0};return g.placement}}}return{getDefaultPlacement:a}}),define("tpa/utils/gluedWidgetMeasuringUtils",["lodash","tpa/layout/tpaGluedWidgetPlacement"],function(a,b){"use strict";function e(a){return"number"==typeof a?a:a?parseFloat(a)||0:0}function f(b,f,g,h,i,j,k){function n(){if(j>=-1&&1>=j){var a=h/2-f/2,b=h-2*d,c=b/2-f/2,e=j*c;l.top=a+e}else if(-1>j&&j>=-2)m=2+j,l.top=m*d;else if(j>1&&2>=j){m=2-j;var g=Math.floor(m*d);
l.top=h-g-f}}function o(){if(k>=-1&&1>=k){var a=g/2-b/2,d=g-2*c,e=d/2-b/2,f=k*e;l.left=a+f}else if(k>1&&2>=k){m=2-k;var h=Math.floor(m*c);l.left=g-h-b}else-1>k&&k>=-2&&(m=2+k,l.left=m*c)}j=e(j),k=e(k);var m,l={};switch(i){case"TOP_LEFT":l.top=0,l.left=0,l.bottom="auto";break;case"TOP_RIGHT":l.top=0,l.right=0,l.bottom="auto";break;case"TOP_CENTER":l.top=0,l.bottom="auto",o();break;case"CENTER_RIGHT":l.right=0,n();break;case"CENTER_LEFT":l.left=0,n();break;case"BOTTOM_LEFT":l.bottom=0,l.left=0,l.top="auto";break;case"BOTTOM_CENTER":l.bottom=0,l.top="auto",o();break;case"BOTTOM_RIGHT":default:l.bottom=0,l.right=0,l.top="auto"}return a.defaults(l,{position:"fixed",top:"",left:""})}function g(b,c){var d={};return c&&c>0&&a.isNumber(b.bottom)&&b.bottom<c&&(d.bottom=c),d}function h(a){return(a>2||-2>a)&&(a=0),a}function i(c,d,e,i,j){var k=h(d.props.horizontalMargin),l=h(d.props.verticalMargin),m=d.props.placement||b.getDefaultPlacement(d.data,c),n=f(d.layout.width,d.layout.height,e,i,m,l,k),o=g(n,j||0),p=a.assign(n,o);return 0===p.right&&(p.left=e-d.layout.width),0===p.bottom&&(p.top=i-d.layout.height-(j||0)),p}var c=300,d=120;return{getGluedWidgetMeasurements:i}}),define("tpa/layout/gluedWidgetMeasurer",["lodash","zepto","tpa/layout/tpaMeasurer","tpa/utils/gluedWidgetMeasuringUtils"],function(a,b,c,d){"use strict";function e(a,b,c,d){var e=d.isMobileView()?"mobileWADTop":"desktopWADTop",f=a+e,g=c[a].querySelector("#"+f);g&&(b.custom[a]={topAd:g.getBoundingClientRect()})}function f(a){return 0===a.right&&(a.left="auto"),0===a.bottom&&(a.top="auto"),0===a.left&&(a.right="auto"),0===a.top&&(a.bottom="auto"),a}function g(e,g,h,i,j,k){var l=k.propertiesItem,m=k.dataItem,n=a.assign(k.layout,{height:b(i[g]).height(),width:b(i[g]).width()}),o=h.width.screen,p=h.height.screen;l.placement=l.placement||e(m,j);var q={props:l,data:m,layout:n},r=j.rendererModel.clientSpecMap,s=d.getGluedWidgetMeasurements(r,q,o,p,h.siteMarginBottom);s=f(s),s.fixedTop=s.top,s.fixedLeft=s.left,delete s.top,delete s.left,a.forEach(s,function(a,b){h[b]=h[b]||{},h[b][g]=a}),h.width[g]=n.width,c.measureTPA(g,h,i)}function h(a){function b(b,c){try{return a.getDefaultPlacement(b,c)}catch(d){return""}}this.measureWixAdComponent=e,this.measureGluedWidget=g.bind(this,b)}return h}),define("tpa/layout/tpaSectionPatcher",["zepto"],function(a){"use strict";return{patchTPASection:function(b,c,d,e,f){var g=d.height[b],h=d.width[b],i=c[b+"iframe"],j=f.os.ios&&f.browser.safari;j&&i&&a(i).css({width:h,height:g})}}}),define("tpa/layout/mobileSafariPatcher",["zepto"],function(a){"use strict";return{patchWidth:function(b,c,d,e,f){var g=a(c[b]).find("iframe"),h=f.os.ios&&f.browser.safari;h&&g&&a(g).css({width:1,minWidth:"100%"})}}}),define("tpa/layout/tpaLayout",["layout","tpa/layout/gluedWidgetPatcher","tpa/layout/gluedWidgetMeasurer","tpa/layout/tpaSectionPatcher","tpa/layout/tpaMeasurer","tpa/layout/tpaGluedWidgetPlacement","tpa/layout/mobileSafariPatcher"],function(a,b,c,d,e,f,g){"use strict";var h=new b(f),i=new c(f);return a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAWidget",e.measureTPA),a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPASection",e.measureTPA),a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAMultiSection",e.measureTPA),a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAGluedWidget",i.measureGluedWidget),a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAWidget"),a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAGluedWidget"),a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPASection"),a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAMultiSection"),a.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPASection",[["iframe"]]),a.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPAMultiSection",[["iframe"]]),a.registerPatcher("wysiwyg.viewer.components.tpapps.TPAGluedWidget",h.patchGluedWidget),a.registerPatcher("wysiwyg.viewer.components.tpapps.TPAMultiSection",d.patchTPASection),a.registerPatcher("wysiwyg.viewer.components.tpapps.TPASection",d.patchTPASection),a.registerPatcher("wysiwyg.viewer.components.tpapps.TPAWidget",g.patchWidth),["wysiwyg.viewer.components.WixAdsMobile","wysiwyg.viewer.components.WixAdsDesktop"].forEach(function(b){a.registerRequestToMeasureChildren(b,[["desktopWADTop"],["mobileWADTop"]]),a.registerCustomMeasure(b,i.measureWixAdComponent)}),{}}),define("tpa/components/tpaPreloaderOverlay",["core"],function(a){"use strict";var b=a.compRegistrar,c=a.compMixins,d={mixins:[c.skinBasedComp],getSkinProperties:function(){return{preloader:{className:"circle-preloader"}}}};b.register("wysiwyg.viewer.components.tpapps.TPAPreloaderOverlay",d)}),define("tpa/services/tpaPreviewEditorCommunicationService",["core"],function(a){"use strict";var d,b=[],c=1,e=a.siteAspectsRegistry,f=function(a){d=a,g()};e.registerSiteAspect("tpaPreviewEditorAspect",f);var g=function(){d.registerToMessage(j.bind(this))},h=function(a,b,c,d){var f,e=i(a,b,c,d);window.parent.postMessage?f=window.parent:window.parent.document.postMessage&&(f=window.parent.document),f&&"undefined"!=typeof f&&f.postMessage(JSON.stringify(e),"*")},i=function(a,d,e,f){var g={intent:"TPA_PREVIEW",callId:c++,type:a,compId:e,data:d};return f&&(b[g.callId]=f),g},j=function(a){if(a&&a.data){var c={};try{c=JSON.parse(a.data)}catch(d){return}switch(c.intent){case"TPA_PREVIEW":c.callId&&b[c.callId]&&(b[c.callId](c.res),delete b[c.callId])}}};return{doPostMessage:h}}),define("tpa/mixins/tpaPreviewEditorMixin",["tpa/services/tpaPreviewEditorCommunicationService"],function(a){"use strict";var b=function(b){a.doPostMessage("openHelp",b)};return{openHelp:b}}),define("tpa/components/tpaUnavailableMessageOverlay",["core","tpa/mixins/tpaPreviewEditorMixin"],function(a,b){"use strict";var c=a.compRegistrar,d=a.compMixins,e={mixins:[d.skinBasedComp,b],getInitialState:function(){return{showOverlay:!0}},getSkinProperties:function(){var a={text:{children:[this.props.compData.text]},dismissButton:{onClick:this.props.compData.hideOverlayFunc},openHelp:this.openHelp};return a}};c.register("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",e)}),define("tpa",["tpa/components/tpaWidget","tpa/components/tpaSection","tpa/components/tpaMultiSection","tpa/components/tpaWorker","tpa/components/tpaGluedWidget","tpa/aspects/tpaAspectCollector","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/layout/tpaLayout","tpa/components/tpaPreloaderOverlay","tpa/components/tpaUnavailableMessageOverlay","tpa/layout/gluedWidgetPatcher","tpa/layout/tpaMeasurer","tpa/layout/tpaSectionPatcher","tpa/mixins/tpaCompBaseMixin","tpa/common/tpaPostMessageCommon","tpa/handlers/tpaHandlers","tpa/common/TPAUrlBuilder","tpa/common/TPABaseUrlBuilder","tpa/utils/tpaStyleUtils","tpa/utils/tpaUtils","tpa/utils/gluedWidgetMeasuringUtils","tpa/services/tpaPreviewEditorCommunicationService"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";return{widget:a,section:b,multiSection:c,worker:d,gluedWidget:e,gluedWidgetMeasuringUtils:v,tpaMixins:{tpaUrlBuilder:g,tpaCompApi:h,tpaCompBase:o},GluedWidgetPatcher:l,tpaMeasurer:m,tpaSectionPatcher:n,tpaHandlers:q,common:{tpaPostMessageCommon:p,TPAUrlBuilder:r,styleUtils:t,TPABaseUrlBuilder:s,utils:u},services:{tpaPreviewEditorCommunicationService:w}}});